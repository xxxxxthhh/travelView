# å¯é€‰ï¼šåœ¨ PR æ—¶æ£€æŸ¥æ˜¯å¦æ„å¤–æäº¤äº†æ•æ„Ÿä¿¡æ¯
name: Security Check

on:
  pull_request:
  push:
    branches:
      - main

jobs:
  check-secrets:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check for sensitive patterns
        run: |
          echo "ğŸ” æ£€æŸ¥æ•æ„Ÿä¿¡æ¯..."

          # æ£€æŸ¥æ˜¯å¦æœ‰ç±»ä¼¼ API key çš„æ¨¡å¼
          if grep -r "AIza[0-9A-Za-z_-]\{35\}" --exclude-dir=.git --exclude="*.example" --exclude="*.md" .; then
            echo "âŒ å‘ç°ç–‘ä¼¼ Google Maps API Keyï¼"
            echo "è¯·æ£€æŸ¥æ˜¯å¦æ„å¤–æäº¤äº†çœŸå®çš„ API key"
            exit 1
          fi

          # æ£€æŸ¥ config.js æ˜¯å¦åŒ…å«çœŸå®å¯†é’¥
          if [ -f "js/config.js" ]; then
            if grep -q "AIza[0-9A-Za-z_-]\{35\}" "js/config.js"; then
              echo "âŒ config.js åŒ…å«çœŸå®çš„ API keyï¼"
              echo "è¯·ç§»é™¤çœŸå®å¯†é’¥ï¼Œåªæäº¤æ¨¡æ¿æ–‡ä»¶"
              exit 1
            fi
          fi

          echo "âœ… å®‰å…¨æ£€æŸ¥é€šè¿‡"

      - name: Check required files
        run: |
          echo "ğŸ“‹ æ£€æŸ¥å¿…éœ€æ–‡ä»¶..."

          required_files=(
            "README.md"
            "README.zh-CN.md"
            "DEPLOY.md"
            "SETUP.md"
            "js/config.js.example"
            ".gitignore"
          )

          for file in "${required_files[@]}"; do
            if [ ! -f "$file" ]; then
              echo "âš ï¸  ç¼ºå°‘æ–‡ä»¶: $file"
              exit 1
            fi
          done

          echo "âœ… æ‰€æœ‰å¿…éœ€æ–‡ä»¶éƒ½å­˜åœ¨"
